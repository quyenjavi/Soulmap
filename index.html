<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Soul Map</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" href="image/favicon.jpg" type="image/jpeg" />
</head>
<body>
  <div class="app" aria-live="polite">
    <!-- Header -->
    <header class="app-header" role="banner">
      <div class="title-block">
        <h1 id="title" class="heading">Soul Map</h1>
        <p id="subtitle" class="subheading">Navigation of Life</p>
      </div>
      <div class="auth-controls">
        <button id="btn-login" class="button">Login</button>
        <div id="user-menu" class="hidden">
          <span id="user-email"></span>
          <button id="btn-logout" class="button">Logout</button>
        </div>
      </div>
    </header>
    <small id="global-msg" class="hint"></small>

    <!-- Intro -->
    <section id="intro" class="intro" aria-label="Intro">
      <p id="intro-text" class="intro-text">Are you ready to open your Soul Map?</p>
      <div class="orb" aria-hidden="true"><div class="orb-glow"></div></div>
    </section>

    <!-- Screen 1: Form -->
    <form id="form" class="form" novalidate aria-label="User inputs">
      <label for="full-name" id="label-full-name" class="label">Full Name</label>
      <input id="full-name" class="input" type="text" maxlength="48" aria-required="true" aria-describedby="name-hint" placeholder="Your full name" />
      <small id="name-hint" class="hint"></small>

      <label for="lang" id="label-lang" class="label">Language</label>
      <select id="lang" class="select">
        <option value="en">English</option>
        <option value="zh">Chinese</option>
        <option value="vi">Vietnamese</option>
        <option value="fr">French</option>
        <option value="es">Spanish</option>
        <option value="ja">Japanese</option>
        <option value="ko">Korean</option>
        <option value="de">German</option>
        <option value="ru">Russian</option>
      </select>

      <label id="label-birthday" class="label">Birthday</label>
      <div class="dob-row" aria-describedby="dob-hint">
        <div class="dob-col">
          <label for="year" id="label-year" class="label">Year</label>
          <select id="year" class="select" aria-required="true"></select>
        </div>
        <div class="dob-col">
          <label for="month" id="label-month" class="label">Month</label>
          <select id="month" class="select" aria-required="true"></select>
        </div>
        <div class="dob-col">
          <label for="day" id="label-day" class="label">Day</label>
          <select id="day" class="select" aria-required="true"></select>
        </div>
      </div>
      <small id="dob-hint" class="hint"></small>

      <button id="calculate" class="button primary" type="submit">Calculate</button>

      <p class="footer-note">Inspired by the timeless wisdom of Pythagoras.</p>
      
    </form>

    <!-- Screen 2: Loading -->
    <section id="loading" class="loading hidden" aria-busy="true" aria-label="Loading">
      <div class="orb large" aria-hidden="true"><div class="orb-glow"></div></div>
      <p id="loading-quote" class="loading-quote"></p>
      <p class="footer-note">Inspired by the timeless wisdom of Pythagoras.</p>
      
    </section>

    <!-- Screen 3: Result -->
      <section id="result" class="result-view hidden" aria-label="Results">
      <!-- Personal Year moved to top -->
      <h2 id="sec-personal-year" class="section-title">Your 2026 Compass ‚≠êÔ∏è</h2>
      <p id="text-personal-year-advice" class="section-text"></p>

      <!-- Hero image card with overlay layer for download -->
      <div class="image-card">
        <!-- Background image (from model) -->
        <img id="result-image" alt="Soul Map visual" />
        <!-- Overlay layer (only used when clicking Share/Download) -->
        <div id="dl-overlay" class="dl-overlay hidden" aria-hidden="true">
          <!-- fixed brand row (inside frame) -->
          <div class="dl-topbar">
            <div class="dl-left">
              <div id="qr-slot" class="qr-slot" aria-label="QR code area"></div>
              <span id="qr-caption" class="qr-caption">Scan to reveal yours</span>
            </div>
            <div class="dl-right">
              <span class="brand-soulmap" aria-label="SoulMap logo text">SoulMap</span>
              <span class="brand-slogan">Inspired by the timeless wisdom of Pythagoras.</span>
            </div>
          </div>
          <!-- translucent text panel (bottom) -->
          <div id="dl-textpanel" class="dl-textpanel">
            <h3 id="dl-name" class="dl-name"></h3>
            <p id="dl-tagline" class="dl-tagline"></p>

            <h4 class="dl-h">Your Core Meaning</h4>
            <p id="dl-core" class="dl-p"></p>

            <h4 class="dl-h">Life Mission</h4>
            <p id="dl-mission" class="dl-p"></p>

            <h4 class="dl-h">Your 2026 Compass ‚≠êÔ∏è</h4>
            <p id="dl-year" class="dl-p"></p>
          </div>
        </div>
      </div>

      <!-- dynamic chips for core numbers -->
      <div id="core-chips" class="chips-row" role="list" aria-label="Core numbers"></div>

      <!-- modal panel for a core detail -->
      <div id="core-detail-panel" class="detail-panel hidden" role="dialog" aria-modal="true" aria-labelledby="core-detail-title">
        <div class="detail-card">
          <button class="close" id="detail-close" aria-label="Close">‚úï</button>
          <h3 id="core-detail-title"></h3>
          <div class="kv">
            <div class="k">Calculation method</div>
            <div class="v" id="detail-method"></div>
          </div>
          <div class="kv">
            <div class="k">Meaning</div>
            <div class="v" id="detail-general"></div>
          </div>
          <div class="kv">
            <div class="k">Personal meaning</div>
            <div class="v" id="detail-personal"></div>
          </div>
        </div>
      </div>

      <!-- Info blocks -->
      <article class="info">
        <h2 id="sec-share" class="section-title">Share</h2>
        <p  id="text-caption" class="section-text"></p>
        <p  id="text-share-text" class="section-text"></p>

        <h2 id="sec-core" class="section-title">Your Core Meaning</h2>
        <p  id="text-core" class="section-text"></p>

        <h2 id="sec-mission" class="section-title">Life Mission</h2>
        <p id="text-mission" class="section-text"></p>

        

        <h2 id="sec-strengths" class="section-title">Strengths</h2>
        <ul id="list-strengths" class="section-list" aria-label="Strengths"></ul>

        <h2 id="sec-challenges" class="section-title">Challenges</h2>
        <ul id="list-challenges" class="section-list" aria-label="Challenges"></ul>
      </article>

      <div class="actions" role="group" aria-label="Actions">
        <p class="download-note">Download & share your journey with someone who matters.</p>
        <button id="download" class="button download-btn">Share</button>
      </div>

      <!-- Chat Box -->
      <section id="chat-box" class="chat-box hidden" aria-label="Ask Soul Coach">
        <div class="chat-hero">
          <div class="coach-avatar"><div class="galaxy-orb"></div></div>
          <div class="hero-text">
            <h2 id="chat-title" class="chat-hero-title">Ask Soul Coach ‚ú®</h2>
            <p class="chat-subtitle">Chat with your Soul Map</p>
          </div>
        </div>
        <div id="chat-chips" class="chips-row" aria-label="Suggested questions"></div>
        <div id="chat-messages" class="chat-messages" aria-live="polite"></div>
        <div class="chat-input-row">
          <input id="chat-input" class="input" type="text" placeholder="Ask Soul Map about your core numbers, life mission, or anything you seek‚Ä¶" />
          <button id="chat-voice" class="icon-btn" type="button" aria-label="Voice"><span>üé§</span></button>
          <button id="chat-send" class="button magic">Send</button>
        </div>
      </section>

      <a href="#" id="try-again" class="try-again">Try again</a>
      <section id="cta-register" class="hidden" aria-label="Register CTA">
        <p>You can register to save your SoulMap and chat later</p>
        <button id="btn-register-save" class="button primary">Register to Save</button>
      </section>
      
      
    </section>
  </div>
  <script src="/env.js" defer></script>
  <script>
    (function(){
      function load(url, next){
        var s=document.createElement('script');
        s.src=url; s.defer=true; if (next) s.onerror=function(){ next(); };
        document.head.appendChild(s);
      }
      if (!window.supabase){
        load('/supabase.js', function(){
          if (!window.supabase){
            load('https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js', function(){
              if (!window.supabase){
                load('https://unpkg.com/@supabase/supabase-js@2/dist/umd/supabase.js');
              }
            });
          }
        });
      }
    })();
  </script>
  <script src="app.js" defer></script>

  <div id="auth-modal" class="modal hidden">
    <div class="modal-card">
      <h3 class="modal-title" id="auth-title">Login</h3>
      <label class="label" for="auth-email">Email</label>
      <input id="auth-email" class="input" type="email" />
      <label class="label" for="auth-password">Password</label>
      <input id="auth-password" class="input" type="password" />
      <label class="label auth-extra" for="auth-confirm">Confirm Password</label>
      <input id="auth-confirm" class="input auth-extra" type="password" />
      <small id="password-strength" class="hint auth-extra"></small>
      <div class="modal-actions">
        <button id="btn-do-login" class="button primary">Sign in</button>
        <button id="btn-do-register" class="button primary hidden">Create account</button>
        <small id="auth-switch" class="hint"><a href="#" id="link-to-register">Don‚Äôt have an account? Register</a><a href="#" id="link-to-login" class="hidden">Already have an account? Login</a></small>
      </div>
      <div id="auth-msg" class="hint" aria-live="polite"></div>
      <div class="modal-footer">
        <button id="auth-close" class="button">Close</button>
      </div>
    </div>
  </div>

  <div id="info-modal" class="modal hidden">
    <div class="modal-card">
      <h3 class="modal-title">Information</h3>
      <div id="info-text" class="hint"></div>
      <div class="modal-footer">
        <button id="info-close" class="button">Close</button>
      </div>
    </div>
  </div>

  <div id="profile-modal" class="modal hidden">
    <div class="modal-card">
      <h3 class="modal-title">Edit Profile</h3>
      <label class="label" for="profile-full-name">Full Name</label>
      <input id="profile-full-name" class="input" type="text" />
      <label class="label" for="profile-lang">Language</label>
      <select id="profile-lang" class="select">
        <option value="en">English</option>
        <option value="zh">Chinese</option>
        <option value="vi">Vietnamese</option>
        <option value="fr">French</option>
        <option value="es">Spanish</option>
        <option value="ja">Japanese</option>
        <option value="ko">Korean</option>
        <option value="de">German</option>
        <option value="ru">Russian</option>
      </select>
      <label class="label" for="profile-dob">Date of Birth</label>
      <input id="profile-dob" class="input" type="date" />
      <div class="modal-actions">
        <button id="btn-save-profile" class="button primary">Save</button>
      </div>
      <div class="modal-footer">
        <button id="profile-close" class="button">Close</button>
      </div>
    </div>
  </div>
</body>
</html>
